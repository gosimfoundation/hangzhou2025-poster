---
// Highly visible PDF Export Button
---

<div class="pdf-button-container">
  <button id="pdf-export-btn" class="pdf-button">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
      <line x1="12" y1="13" x2="12" y2="13"></line>
      <line x1="16" y1="17" x2="8" y2="17"></line>
    </svg>
    导出PDF
  </button>
</div>

<style>
  .pdf-button-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 999999;
  }

  .pdf-button {
    background: #f4f593;
    color: #333;
    border: 3px solid #333;
    padding: 15px 30px;
    border-radius: 50px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
    font-family: 'Noto Sans SC', 'Inter', sans-serif;
  }

  .pdf-button:hover {
    background: #e8e980;
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
  }

  .pdf-button:active {
    transform: translateY(0) scale(1);
  }

  .pdf-button svg {
    width: 20px;
    height: 20px;
  }

  .pdf-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Make sure button is always visible */
  @media (max-width: 480px) {
    .pdf-button-container {
      bottom: 10px;
      right: 10px;
    }
    
    .pdf-button {
      padding: 12px 20px;
      font-size: 14px;
    }
  }

  @media print {
    .pdf-button-container {
      display: none !important;
    }
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    console.log('PDF Button Script Loaded');
    
    const btn = document.getElementById('pdf-export-btn');
    if (!btn) {
      console.error('Button not found!');
      return;
    }
    
    console.log('Button found:', btn);
    
    // Make sure button is visible
    btn.style.display = 'flex';
    btn.style.visibility = 'visible';
    
    btn.addEventListener('click', function() {
      console.log('Button clicked!');
      alert('PDF导出功能已激活！正在生成PDF...');
      
      btn.disabled = true;
      btn.textContent = '生成中...';
      
      // Get the page content - make sure it exists
      const element = document.querySelector('.page-wrapper');
      if (!element) {
        console.error('Page wrapper not found!');
        alert('页面内容未找到，请刷新页面重试');
        btn.disabled = false;
        btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="13" x2="12" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg> 导出PDF';
        return;
      }
      
      // Get current viewport
      const viewportHeight = window.innerHeight;
      const scrollY = window.scrollY;
      
      // Clone the entire element
      const clone = element.cloneNode(true);
      
      // Remove button from clone
      const btnInClone = clone.querySelector('.pdf-button-container');
      if (btnInClone) btnInClone.remove();
      
      // Create temporary container that captures visible viewport
      const container = document.createElement('div');
      container.style.width = window.innerWidth + 'px';
      container.style.height = viewportHeight + 'px';
      container.style.overflow = 'hidden';
      container.style.position = 'absolute';
      container.style.top = '0';
      container.style.left = '0';
      container.style.zIndex = '-10000';
      container.style.background = 'white';
      
      // Wrapper to position the content
      const wrapper = document.createElement('div');
      wrapper.style.position = 'relative';
      wrapper.style.top = -scrollY + 'px';
      wrapper.style.left = '0';
      wrapper.appendChild(clone);
      
      container.appendChild(wrapper);
      document.body.appendChild(container);
      
      // PDF options with better settings
      const opt = {
        margin: 0,
        filename: 'GOSIM-Poster.pdf',
        image: { 
          type: 'jpeg', 
          quality: 0.95 
        },
        html2canvas: { 
          scale: 2,
          useCORS: true,
          logging: false,
          width: window.innerWidth,
          height: viewportHeight,
          windowWidth: window.innerWidth,
          windowHeight: viewportHeight,
          scrollX: 0,
          scrollY: 0
        },
        jsPDF: { 
          unit: 'px', 
          format: [window.innerWidth, viewportHeight],
          orientation: 'portrait' 
        },
        enableLinks: false
      };
      
      // Generate PDF
      if (typeof html2pdf !== 'undefined') {
        console.log('Starting PDF generation...');
        html2pdf().set(opt).from(container).save().then(function() {
          console.log('PDF generated successfully');
          document.body.removeChild(container);
          btn.disabled = false;
          btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="13" x2="12" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg> 导出PDF';
          alert('PDF导出成功！');
        }).catch(function(error) {
          console.error('PDF generation failed:', error);
          document.body.removeChild(container);
          btn.disabled = false;
          btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="13" x2="12" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg> 导出PDF';
          alert('PDF导出失败: ' + error.message);
        });
      } else {
        alert('html2pdf库未加载，请刷新页面重试');
        btn.disabled = false;
        btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="13" x2="12" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg> 导出PDF';
      }
    });
  });
</script>