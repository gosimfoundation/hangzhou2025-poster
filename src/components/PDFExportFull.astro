---
// Full page PDF export that captures everything
---

<div class="pdf-button-wrapper">
  <button id="pdf-export-full" class="pdf-export-button">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
    </svg>
    导出PDF
  </button>
</div>

<style>
  .pdf-button-wrapper {
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 99999;
  }

  .pdf-export-button {
    background: #f4f593;
    color: #333;
    border: 2px solid #333;
    padding: 12px 24px;
    border-radius: 50px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    font-family: 'Noto Sans SC', sans-serif;
  }

  .pdf-export-button:hover {
    background: #e8e980;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
  }

  .pdf-export-button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  @media print {
    .pdf-button-wrapper {
      display: none !important;
    }
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const btn = document.getElementById('pdf-export-full');
    
    btn.addEventListener('click', function() {
      btn.disabled = true;
      btn.textContent = '生成中...';
      
      // Get the main content wrapper
      const content = document.querySelector('.page-wrapper');
      
      if (!content) {
        alert('无法找到页面内容');
        btn.disabled = false;
        btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg> 导出PDF';
        return;
      }
      
      // Clone the content for PDF generation
      const clone = content.cloneNode(true);
      
      // Remove the PDF button from the clone
      const btnInClone = clone.querySelector('.pdf-button-wrapper');
      if (btnInClone) btnInClone.remove();
      
      // Create a temporary container with full height
      const tempContainer = document.createElement('div');
      tempContainer.style.position = 'absolute';
      tempContainer.style.left = '-9999px';
      tempContainer.style.top = '0';
      tempContainer.style.width = content.offsetWidth + 'px';
      tempContainer.appendChild(clone);
      document.body.appendChild(tempContainer);
      
      // Get the full height after adding to DOM
      const fullHeight = tempContainer.scrollHeight;
      const fullWidth = tempContainer.scrollWidth || 480;
      
      // Configuration for a single long page with full content
      const opt = {
        margin:       0,
        filename:     'GOSIM-Poster.pdf',
        image:        { 
          type: 'jpeg', 
          quality: 0.98 
        },
        html2canvas:  { 
          scale: 2,
          scrollY: 0,
          scrollX: 0,
          width: fullWidth,
          height: fullHeight,
          windowWidth: fullWidth,
          windowHeight: fullHeight,
          useCORS: true,
          logging: false
        },
        jsPDF:        { 
          unit: 'px', 
          format: [fullWidth, fullHeight], 
          orientation: 'portrait' 
        },
        pagebreak:    { 
          mode: 'avoid-all',
          before: [],
          after: [],
          avoid: 'img'
        }
      };
      
      // Generate PDF from the cloned content
      html2pdf().set(opt).from(tempContainer).save().then(function() {
        // Clean up
        document.body.removeChild(tempContainer);
        btn.disabled = false;
        btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg> 导出PDF';
      }).catch(function(error) {
        console.error('PDF export error:', error);
        // Clean up
        document.body.removeChild(tempContainer);
        btn.disabled = false;
        btn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg> 导出PDF';
        alert('PDF导出失败');
      });
    });
  });
</script>